# Cyberpunk 2077 Wiki API

REST API для доступа к данным из Cyberpunk 2077 Wiki с автоматическим скрапингом данных, кэшированием и поиском.

## Возможности

- Получение данных по различным категориям (персонажи, транспорт, оружие, локации, корпорации, квесты)
- Детальный поиск по названиям, описаниям и содержимому
- Двухуровневое кэширование: Redis + файловая система
- Автоматическое обновление данных в фоновом режиме
- Автодокументация API с Swagger UI
- Работа в режиме без Redis (только файловое кэширование)

## Требования

- Python 3.9+
- FastAPI
- Redis (опционально, но рекомендуется)
- fandom-py
- Остальные зависимости в pyproject.toml

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/Wiki-Cyberpank2077.git
cd Wiki-Cyberpank2077/backend
```

2. Создайте и активируйте виртуальное окружение (опционально):
```bash
# На Windows
python -m venv venv
venv\Scripts\activate

# На Linux/Mac
python -m venv venv
source venv/bin/activate
```

3. Установите зависимости с помощью Poetry:
```bash
pip install poetry
poetry install
```

4. Создайте файл .env на основе .env.example:
```bash
cp .env.example .env
```

5. Отредактируйте .env и настройте параметры:
   - `USE_REDIS_CACHE=False` если Redis не доступен
   - Настройте пути для хранения данных `TEMP_DIR`, `LOG_DIR`
   - При необходимости измените настройки Wiki API, по умолчанию используется Cyberpunk 2077

## Запуск API

Используйте утилиту управления:

```bash
# Запуск сервера разработки
python manage.py run --reload

# Предварительный сбор данных для всех категорий (рекомендуется)
python manage.py scrape all

# Сбор данных для конкретной категории
python manage.py scrape characters
python manage.py scrape vehicles
python manage.py scrape locations
python manage.py scrape weapons
python manage.py scrape corporations
python manage.py scrape quests
```

API будет доступен по адресу: http://localhost:8000

## Документация API

После запуска API, документация Swagger UI доступна по адресу:
- http://localhost:8000/docs

Вы можете использовать эту страницу для просмотра всех эндпоинтов и тестирования API.

## Основные эндпоинты

- `GET /api/v1/wiki/categories` - Получить список всех доступных категорий
- `GET /api/v1/wiki/categories/{category_name}` - Получить элементы определенной категории
- `GET /api/v1/wiki/items/{item_title}` - Получить детальную информацию по конкретному элементу
- `GET /api/v1/wiki/search?q={search_query}` - Поиск элементов по текстовому запросу
- `GET /api/v1/wiki/refresh/{category_name}` - Принудительно обновить данные категории

## Примеры использования

### Получение списка категорий

```bash
curl -X GET "http://localhost:8000/api/v1/wiki/categories"
```

### Получение персонажей

```bash
curl -X GET "http://localhost:8000/api/v1/wiki/categories/characters?limit=10&offset=0"
```

### Поиск по запросу

```bash
curl -X GET "http://localhost:8000/api/v1/wiki/search?q=Johnny%20Silverhand"
```

### Получение деталей персонажа

```bash
curl -X GET "http://localhost:8000/api/v1/wiki/items/V"
```

### Получение информации о транспорте

```bash
curl -X GET "http://localhost:8000/api/v1/wiki/categories/vehicles"
```

### Получение информации о локациях

```bash
curl -X GET "http://localhost:8000/api/v1/wiki/categories/locations"
```

## Структура данных

Каждый элемент Wiki содержит следующие поля:
- `id` - Идентификатор страницы в Wiki (может отсутствовать)
- `title` - Название элемента
- `url` - URL страницы в Wiki
- `description` - Краткое описание
- `categories` - Список категорий, к которым относится элемент
- `images` - Список изображений, связанных с элементом
- `sections` - Разделы страницы (содержат title и content)
- `related_pages` - Связанные страницы Wiki
- `infobox` - Структурированные данные из боковой панели Wiki

## Структура проекта

```
backend/
  ├── src/                   # Исходный код проекта
  │   ├── api/               # API эндпоинты
  │   │   ├── v1/            # Маршруты API версии 1
  │   │   │   └── wiki/      # Маршруты Wiki API
  │   │   └── schemas.py     # Pydantic модели
  │   ├── app/               # Прикладные модули
  │   │   ├── redis/         # Работа с Redis и кэширование
  │   │   └── scraper/       # Скрапинг Wiki
  │   ├── core/              # Основные компоненты
  │   │   └── config.py      # Настройки приложения
  │   └── main.py            # Точка входа FastAPI
  ├── data/                  # Директория для данных
  │   ├── cache/             # Кэш файловой системы
  │   ├── characters/        # Отдельные файлы персонажей
  │   ├── vehicles/          # Отдельные файлы транспорта
  │   └── locations/         # Отдельные файлы локаций
  ├── logs/                  # Логи приложения
  ├── pyproject.toml         # Зависимости проекта (Poetry)
  ├── poetry.lock            # Зафиксированные версии зависимостей
  ├── .env                   # Переменные окружения
  ├── manage.py              # Утилита управления
  └── README.md              # Документация
```

## Оптимизации и новые возможности

- **Двухуровневое кэширование**: Redis для быстрого доступа, файловая система для отказоустойчивости
- **Автономная работа**: Возможность работы без Redis, только с файловым кэшем
- **Категоризация**: Улучшенная поддержка категорий с добавлением новых (квесты, корпорации)
- **Структурированное хранение**: Каждый элемент сохраняется в отдельный файл для удобного доступа
- **Настройка через .env**: Все параметры API можно настроить через файл конфигурации
- **Улучшенный поиск**: Поиск выполняется не только по названиям, но и по содержимому разделов

## Примечания

- При первом запросе к категории данные автоматически загружаются
- Для оптимальной работы рекомендуется предварительно заполнить кэш всех категорий командой `python manage.py scrape all`
- Кэш данных хранится 24 часа, после чего обновляется автоматически
- Для разработки можно отключить кэширование, установив DEBUG_MODE=True в .env
- Доступны предварительно настроенные категории: персонажи, транспорт, оружие, локации, корпорации и квесты 